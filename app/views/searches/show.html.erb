<% title _('Geyser - Search') %>

<div id="main-content">

  <div class="header" style="letter-spacing: 1px;"><%= _('Search') %></div>
  <p class="break"></p>

  <%= render partial: "shared/search_form", locals: { branches: @branches, branch: @branch, arch: @arches&.first, arches: @branch.arches, query: @query || params[:query]} %>

  <br>
  <br>
  <%= _('On your query &quot;').html_safe %><b><%= params[:query] %></b>
  <%- if @branch.persisted? %>
    <%= (_('&quot; in branch <b>%s</b> were found') % @branch.name).html_safe %>
  <%- else %>
    <%= _('&quot; in all branches were found').html_safe %>
  <%- end %>
  <b><%= @spkgs.total_count %></b>
  <%= n_('RPM:', 'RPMs:', @spkgs.total_count) %>

  <p class="break"></p>
  <br>
  <table id='bugs' cellspacing='0' cellpadding='3'>
    <tr>
      <%- if @branch.perpetual? %>
        <th><%= raw _('repo<br>cop') %></th>
      <%- end %>
      <th><%= _('package') %></th>
      <th><%= raw _('current<br>version') %></th>
      <%- if @branch.new_record? %>
        <th><%= raw _('branches') %></th>
      <%- end %>
      <th><%= _('build time') %></th>
      <th><%= _('age') %></th>
      <th><%= _('Url') %></th>
      <th><%= _('summary') %></th>
    </tr>

    <% @spkgs.each do |spkg| %>
      <% if spkg %>
        <%- spkg = spkg.decorate %>
        <tr>
          <%- if @branch.perpetual? %>
            <td>
              <%= link_to image_tag("#{ spkg.repocop_status }.png", size: '20x20', alt: spkg.repocop_status), repocop_srpm_path(@branch, spkg), class: 'repocoplink', title: _('repocop') %>
            </td>
          <%- end %>
          <td class="strange">
            <%- if spkg.first_branch %>
              <%= link_to spkg.name, versioned_srpm_path(spkg.branches.first, spkg, version: spkg.evr), class: 'news' %>
            <%- else %>
              <b class="news"><%= spkg.name %></b>
            <%- end %>
          </td>
          <td><%= spkg.evr %></td>
          <%- if @branch.new_record? %>
            <td>
              <%- if spkg.branches.present? %>
                <%- spkg.branches.each do |b| %>
                  <%= link_to b.name, home_path(branch: b.slug), title: _('site home page') %>
                <%- end %>
              <%- end %>
            </td>
          <%- end %>
          <td><%= spkg.buildtime %></td>
          <td><%= "#{ time_ago_in_words(spkg.buildtime) } #{ _('ago') }" %></td>
          <td><%= spkg.short_url %></td>
          <td><%= spkg.summary %></td>
        <% end %>
      </tr>
    <% end %>
  </table>

  <div style="text-align:center">
    <%= paginate @spkgs %>
  </div>

<div id="bottom-offset-l">
  <div id="bottom-offset-r">
    &nbsp;
  </div>
</div>
